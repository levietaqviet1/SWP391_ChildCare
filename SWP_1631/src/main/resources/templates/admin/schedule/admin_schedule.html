<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.springframework.org/schema/data/jaxb http://www.thymeleaf.org">>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!----======== CSS ======== -->
    <link rel="stylesheet" th:href="@{/admin/schedule/css/style.css}">

    <title></title>

    <!--script-->
    <script src="https://kit.fontawesome.com/28a1dc3e10.js" crossorigin="anonymous"></script>
    <!--<title>Admin Dashboard Panel</title>-->
</head>

<body>
<nav>
    <div class="logo-name">
        <div class="logo-image">
            <img th:src="@{/images/logo.jpg}" alt="">
        </div>

        <span class="logo_name"><a href="listaccount"
                                   style="text-decoration: none;color: black">Admin Page</a></span>
    </div>

    <div class="menu-items">
        <ul class="nav-links">
            <li><a href="/admin/">
                <i class="uil uil-estate"></i>
                <span class="link-name">Account</span>
            </a></li>

            <li><a href="/kinderController/">
                <i class="uil uil-chart"></i>
                <span class="link-name">Kindergartner</span>
            </a></li>
            <li><a href="/admin/clazz">
                <i class="uil uil-thumbs-up"></i>
                <span class="link-name">Class</span>
            </a></li>
            <li><a href="/admin/scheduleT">
                <i class="uil uil-comments"></i>
                <span class="link-name">Schedule</span>
            </a></li>
        </ul>

        <ul class="logout-mode">
            <li><a href="/home/logoutSuccessful">
                <i class="uil uil-signout"></i>
                <span class="link-name">Logout</span>
            </a></li>
            </li>
        </ul>
    </div>
</nav>

<div class="dashboard">
    <div class="dash-lefttop">
        <img src="https://i.pinimg.com/originals/72/45/fb/7245fb0ca786bb4a98fb8465e437c5bb.jpg" alt="">
        <!--        <a href="#">${sessionScope.account.firstName} </a>-->
    </div>
    <div class="test">

    </div>
    <form id="f" action="listschedule" method="post">
        <div class="select-menu">
            <!--class-->
            <div class="class-select">
                <!--                <c:set value="${requestScope.cid_raw}" var="cid_raw"/>-->

                <select class="form-select form-select-sm" aria-label=".form-select-sm example" name="cid"
                        style="height: 36px;">
                    <!--<option selected>Select Class</option>-->
                    <option
                            th:each="cl:${classes}"
                            th:text="${cl.className}"
                            th:value="${cl.clazzId}"></option>
                    <!--                            th:selected="${Account.role.roleID==Role.roleID}"-->


                    <!--                    <c:forEach items="${requestScope.classes}" var="cl">-->
                    <!--                        <option <c:if test="${cl.class_id eq cid_raw}">selected</c:if>-->
                    <!--                                value="${cl.class_id}">${cl.class_name}</option>-->
                    <!--                    </c:forEach>-->
                </select>
            </div>

            <!--            <c:set value="${requestScope.firstMonday}" var="fM"/>-->
            <!--            <c:set value="${requestScope.recentMonday}" var="rM"/>-->

            <select name="datee" id="ddlViewBy">
                <option
                        th:each="w:${weeks}"
                        th:text="${w.value}"
                        th:value="${w.key}"
                        th:selected="${w.key==firstMonday}"></option>

                <!--                <c:forEach items="${requestScope.weeks}" var="w">-->
                <!--                    <c:set value="${w.key}" var="wk"></c:set>-->
                <!--                    <option <c:if test="${wk eq fM || wk eq rM}">selected</c:if>-->
                <!--                            value="${wk}">${w.value}</option>-->
                <!--                </c:forEach>-->
            </select>

            <button class="btn btn-outline-success" type="submit"
                    onclick="changeDate()">Search
            </button>
    </form>
</div>

<div class="dash-bottomtable">
    <table class="table" style="margin-bottom: 0">
        <thead style="bgcolor: red">
        <!--        <c:set var="sde" value="${requestScope.scheduleDetails}">-->
        <!--        </c:set>-->

        <tr>
            <th></th>
            <!--            <td th:text="${#dates.format(sprint.releaseDate, 'dd-MMM-yyyy')}"></td>-->
            <th scope="col"
                th:each="map:${scheduleDetails.scheduleMap}"
                th:text="${#dates.format(map.key, 'EEE') }"></th>

        </tr>

        <tr>
            <th></th>
            <th scope="col"
                th:each="map:${scheduleDetails.scheduleMap}"
                th:text="${#dates.format(map.key, 'dd/MM') }"></th>
        </tr>
        </thead>
        <div th:each="loop:${loop}">
            <tr>
                <td style="text-align: center;vertical-align: middle;font-weight: bold">
                    Slot <span th:text="${loop+1}"></span>
                </td>
                <div th:each="map:${scheduleDetails.scheduleMap}">
                    <!--if slot not null-->
                    <div th:switch="${map.value[loop] != null}">
                        <div th:case="true">

                            <td style="min-height: 1px">
                                <div style="display: flex">
<!--                                    <fmt:formatDate pattern='yyyy-MM-dd' value="${map.key}" var="date_picked"/>-->
<!--                                    <c:set var="date_picked_converted" value="${date_picked}"/>-->
<!--                                    <c:set var="schedule_update_index"-->
<!--                                           value="${date_picked_converted}:${loop.index + 1}"/>-->
<!--                                    <c:set var="schedule_update_old"-->
<!--                                           value="${date_picked_converted}:${loop.index + 1}:old"/>-->

                                    <div class="schedule-list" style="width: 80px;" id="${schedule_update_old}">
                                        ${map.value[loop.index].activity.act_name}
                                        <!--${map.value[loop.index].schedule_id}-->
                                    </div>

                                    <div id="${schedule_update_index}" style="display: none">

                                        <form action="updateschedule" method="post">
                                            <!--<h1>${map.value[loop.index].schedule_id}</h1>-->
                                            <input name="schedule_id" value="${map.value[loop.index].schedule_id}"
                                                   type="hidden"/>
                                            <input name="schedule-update-index" value="${schedule_update_index}"
                                                   type="hidden"/>
                                            <input name="date_picked_converted" value="${date_picked_converted}"
                                                   type="hidden"/>
                                            <input name="cid_raw" value="${cid_raw}" type="hidden"/>
                                            <!--<input name="cid_raw" value="${cid_raw}" type="hidden"/>-->
                                            <input name="slot_chosen" value="${loop.index + 1}" type="hidden"/>
                                            <select name="select_activity" style="max-width: 100%; margin-bottom: 4px;">
                                                <c:forEach items="${requestScope.activity}" var="act">
                                                    <option value="${act.activity_id}"
                                                    <c:if test="${map.value[loop.index].activity.activity_id eq act.activity_id}">
                                                        selected
                                                    </c:if>
                                                    >
                                                    ${act.act_name}</option>
                                                </c:forEach>
                                            </select>
                                            <!--<div>-->
                                            <a class="update_confirm">
                                                <button type="submit">
                                                    Update <i class="fa-solid fa-pen"></i>
                                                </button>
                                            </a>

                                            <a class="update_cancel"
                                               onclick="cancelUpdate('${schedule_update_index}', '${schedule_update_old}')">
                                                Cancel <i class="fa-solid fa-ban"></i>
                                            </a>
                                            <!--</div>-->
                                        </form>
                                    </div>

                                    <div class="dropdown" style="flex-grow: 1;">
                                        <button
                                                class="btn-sm btn-option btn-secondary dropdown-toggle" type="button"
                                                id="dropdownMenuButton"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <a class="dropdown-item" href="#"
                                               onclick="doDelete('${map.value[loop.index].schedule_id}')">
                                                <i class="fa-delete fa-solid fa-trash fa-fw fa-align-center"></i> Delete</a>
                                            <a class="dropdown-item" href="#"
                                               onclick="doUpdate('${schedule_update_index}', '${schedule_update_old}')">
                                                <i class="fa fa-edit"></i> Update</a>
                                        </div>
                                    </div>
                                </div>
                            </td>

                        </div>
                        <div th:case="false">
                            <!--if slot null-->

                            <td style="text-align: center;vertical-align: middle;" class="empty-cell">
                                <form action="addschedule" method="post">
<!--                                    <fmt:formatDate pattern='yyyy-MM-dd' value="${map.key}" var="date_picked"/>-->
<!--                                    <c:set var="date_picked_converted" value="${date_picked}"/>-->
                                    <input name="date_picked_converted" th:value="${#dates.format(map.key, 'yyyy/MM/dd')}" type="hidden"/>
                                    <input name="cid_raw" value="${cid_raw}" type="hidden"/>
                                    <input name="slot_chosen" value="${loop + 1}" type="hidden"/>

                                    <div class="add-button">
                                        <select name="select_activity" style="max-width: 100px">
                                            <option
                                                    th:each="act:${activity}"
                                                    th:text="${act.name}"
                                                    th:value="${act.activityid}"></option>
                                        </select>
                                        <button type="submit">
                                            <i class="fa-solid fa-2x fa-circle-plus fa-fw" style="color: #12ef73"></i>
                                        </button>
                                    </div>
                                </form>
                            </td>

                        </div>
                    </div>
                </div>
            </tr>
        </div>


    </table>
</div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script src="admin/schedule/js/schedule.js"></script>
</body>

</html>